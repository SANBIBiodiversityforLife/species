{% extends "website/_base.html" %}
{% load static %}
{% load mptt_tags %}
{% load rest_framework %}

{% block css %}
<link href="{% static 'taxon.css' %}" rel="stylesheet">
<link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
{% endblock css %}

{% block body_attributes %} data-spy="scroll" data-target="#species-side-nav" style="position: relative"{% endblock %}

{% block heading %}
	<section id="taxon-heading" class="triangles banner">
		<div class="container">
      <!-- Hierarchical path -->
      <div id="breadcrumb">
        {% for item in ancestors %}
        {% if not forloop.first %}<a href="{% url 'taxa_detail' item.id %}">{% endif %}
        {{ item.name }}
        {% if not forloop.first %}</a>{% endif %}
        {% if not forloop.last %}<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>{% endif %}
        {% endfor %}
      </div>

      <!-- Name and rank -->
      <h1>{{ taxon.get_full_name|safe }}</h1>
      <hr>
      <p>Rank: {{ taxon.rank }}, {% if taxon.synonyms %}Synonyms: {{ taxon.synonyms|join:" // " }}{% else %}Name status: Accepted{% endif %}</p>

      <!-- Common names -->
      <h2>Common names: {{ taxon.common_names|join:" // " }}{% if user.is_authenticated %}
    <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#commonNamesModal">Add</button>{% endif %}</h2>
    </div>
	</section>
{% endblock %}

{% block content %}
<!-- Images -->
<div id="species-images">
  {% for img_url in taxon.images %}
  <img src="{{ img_url }}">
  {% endfor %}
</div>

<!-- Main content of species page -->
<div class="row">
  <div class="col-md-9"><div id="species-info">
  {% for key, item in taxon.info.items %}
  {% if item %}
    <h2 id="{{ key }}">{{ key }}{% if user.is_authenticated %}
    <button type="button" class="btn btn-info btn-sm">Edit</button>{% endif %}</h2>
    {{ item|safe }}
  {% endif %}
  {% endfor %}
  </div></div>
  <div class="col-md-3">
    <ul id="species-side-nav" class="nav nav-pills nav-stacked" data-spy="affix" data-offset-top="20" data-offset-bottom="200">
      {% for key, item in taxon.info.items %}{% if item %}
      <li><a href="#{{ key }}">{{ key }}</a></li>
      {% endif %}{% endfor %}
    </ul>
  </div>
</div>




<!-- Modal -->
<div class="modal fade" id="commonNamesModal" tabindex="-1" role="dialog" aria-labelledby="commonNamesModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Add common name</h4>
      </div>

      <!-- Common names form -->
      <form action="#" method="POST" class="form-inline">
      <div class="modal-body">
          {% csrf_token %}
          {% render_form cn template_pack='rest_framework/inline' %}
          <input type="submit" value="Save">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block js %}
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/1.0.1/trianglify.min.js"></script>
<script>
$(document).ready(function() {
	var params = {
	  height: $('.triangles').outerHeight(),
		width: $('.triangles').outerWidth(),
    x_colors: 'Blues',
    y_colors: 'match_x'
  };
	var pattern = new Trianglify(params);
	$('.triangles').attr('style', 'background: url(' + pattern.png() + ') no-repeat center center');

});
</script>
{% endblock js %}

